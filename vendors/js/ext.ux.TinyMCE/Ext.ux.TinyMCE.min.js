(function(){Ext.namespace("Ext.ux");var d=false;var c=new Ext.WindowGroup();c.zseed=12000;Ext.ux.TinyMCE=Ext.extend(function(e){var f={tinymceSettings:{accessibility_focus:false}};Ext.apply(f,e);this.addEvents({editorcreated:true});Ext.ux.TinyMCE.superclass.constructor.call(this,f)},Ext.form.Field,{tinymceSettings:null,allowBlank:true,invalidText:"The value in this field is invalid",invalidClass:"invalid-content-body",minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",blankText:"This field is required",hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:1px;height:1px;",autocomplete:"off"},initComponent:function(){this.tinymceSettings=this.tinymceSettings||{};Ext.ux.TinyMCE.initTinyMCE({language:this.tinymceSettings.language})},initEvents:function(){this.originalValue=this.getValue()},onRender:function(f,e){Ext.ux.TinyMCE.superclass.onRender.call(this,f,e);var h=this.getEl();if(Ext.type(this.width)=="number"){this.tinymceSettings.width=this.width}if(Ext.type(this.height)=="number"){this.tinymceSettings.height=this.height}this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");this.textareaEl=this.el;var j={overflow:"hidden"};if(Ext.isIE){j["margin-top"]="-1px";j["margin-bottom"]="-1px"}this.wrapEl=this.el.wrap({style:j});this.actionMode="wrapEl";var k=this.getId();this.ed=new tinymce.Editor(k,this.tinymceSettings);var g=new Ext.util.DelayedTask(this.validate,this);this.ed.onKeyPress.add(function(m,l){g.delay(250)}.createDelegate(this));this.ed.onBeforeRenderUI.add(function(m,l){m.controlManager=new a(this,m)}.createDelegate(this));this.ed.onPostRender.add(function(m,l){var o=m.settings;var p=Ext.get(Ext.DomQuery.selectNode("#"+this.ed.id+"_tbl td.mceToolbar"));if(p!=null){var n=p.select("> table.mceToolbar");Ext.DomHelper.append(p,{tag:"div",id:this.ed.id+"_xtbar",style:{overflow:"hidden"}},true).appendChild(n)}m.windowManager=new b(this.ed);Ext.get(m.getContentAreaContainer()).addClass("patch-content-body");Ext.Element.fly(o.content_editable?m.getBody():m.getWin()).on("focus",this.onFocus,this);Ext.Element.fly(o.content_editable?m.getBody():m.getWin()).on("blur",this.onBlur,this,this.inEditor&&Ext.isWindows&&Ext.isGecko?{buffer:10}:null)}.createDelegate(this));this.ed.onChange.add(function(n,m){this.fireEvent("change",n,m)}.createDelegate(this));this.ed.render();tinyMCE.add(this.ed);(function i(){if(!this.isVisible()){arguments.callee.defer(50,this);return}var l=this.getSize();this.withEd(function(){this._setEditorSize(l.width,l.height);this.fireEvent("editorcreated")})}).call(this)},getResizeEl:function(){return this.wrapEl},getName:function(){return this.rendered&&this.textareaEl.dom.name?this.textareaEl.dom.name:(this.name||"")},initValue:function(){if(!this.rendered){Ext.ux.TinyMCE.superclass.initValue.call(this)}else{if(this.value!==undefined){this.setValue(this.value)}else{var e=this.textareaEl.value;if(e){this.setValue(e)}}}},beforeDestroy:function(){if(this.ed){tinyMCE.remove(this.ed)}if(this.wrapEl){Ext.destroy(this.wrapEl)}Ext.ux.TinyMCE.superclass.beforeDestroy.call(this)},getRawValue:function(){if(!this.rendered||!this.ed.initialized){return Ext.value(this.value,"")}var e=this.ed.getContent();if(e===this.emptyText){e=""}return e},getValue:function(){if(!this.rendered||!this.ed.initialized){return Ext.value(this.value,"")}var e=this.ed.getContent();if(e===this.emptyText||e===undefined){e=""}return e},setRawValue:function(e){this.value=e;if(this.rendered){this.withEd(function(){this.ed.undoManager.clear();this.ed.setContent(e===null||e===undefined?"":e);this.ed.startContent=this.ed.getContent({format:"raw"})})}},setValue:function(e){this.value=e;if(this.rendered){this.withEd(function(){this.ed.undoManager.clear();this.ed.setContent(e===null||e===undefined?"":e);this.ed.startContent=this.ed.getContent({format:"raw"});this.validate()})}},isDirty:function(){if(this.disabled||!this.rendered){return false}return this.ed&&this.ed.initialized&&this.ed.isDirty()},syncValue:function(){if(this.rendered&&this.ed.initialized){this.ed.save()}},getEd:function(){return this.ed},disable:function(){this.withEd(function(){var e=this.ed.getBody();e=Ext.get(e);if(e.hasClass("mceContentBody")){e.removeClass("mceContentBody");e.addClass("mceNonEditable")}})},enable:function(){this.withEd(function(){var e=this.ed.getBody();e=Ext.get(e);if(e.hasClass("mceNonEditable")){e.removeClass("mceNonEditable");e.addClass("mceContentBody")}})},onResize:function(f,e){if(Ext.type(f)!="number"){f=this.getWidth()}if(Ext.type(e)!="number"){e=this.getHeight()}if(f==0||e==0){return}if(this.rendered){this.withEd(function(){this._setEditorSize(f,e)})}},_setEditorSize:function(e,n){if(!this.ed.theme.AdvancedTheme){return}if(e<100){e=100}if(n<129){n=129}var g=Ext.get(this.ed.id+"_tbl"),j=Ext.get(this.ed.id+"_ifr"),f=Ext.get(this.ed.id+"_xtbar");var p=e;if(g){p=e-g.getFrameWidth("lr")}var k=0;if(f){k=f.getHeight();var m=f.findParent("td",5,true);k+=m.getFrameWidth("tb");f.setWidth(p)}var i=g.child(".mceStatusbar");var o=0;if(i){o+=i.getHeight()}var h=n-k-o;var l=j.findParent("td",5,true);if(l){h-=l.getFrameWidth("tb")}g.setSize(e,n);j.setSize(p,h)},focus:function(f,e){if(e){this.focus.defer(typeof e=="number"?e:10,this,[f,false]);return}this.withEd(function(){this.ed.focus()});return this},processValue:function(e){return Ext.util.Format.stripTags(e)},validateValue:function(e){if(Ext.isFunction(this.validator)){var g=this.validator(e);if(g!==true){this.markInvalid(g);return false}}if(e.length<1||e===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(e.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(e.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var f=Ext.form.VTypes;if(!f[this.vtype](e,this)){this.markInvalid(this.vtypeText||f[this.vtype+"Text"]);return false}}if(this.regex&&!this.regex.test(e)){this.markInvalid(this.regexText);return false}return true},withEd:function(e){if(!this.ed){this.on("editorcreated",function(){this.withEd(e)},this)}else{if(this.ed.initialized){e.call(this)}else{this.ed.onInit.add(function(){e.defer(10,this)}.createDelegate(this))}}}});Ext.apply(Ext.ux.TinyMCE,{tinymcePlugins:"pagebreak,style,layer,table,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,noneditable,visualchars,nonbreaking,xhtmlxtras,template",initTinyMCE:function(f){if(!d){var e={mode:"none",plugins:Ext.ux.TinyMCE.tinymcePlugins,theme:"advanced"};Ext.apply(e,f);if(!tinymce.dom.Event.domLoaded){tinymce.dom.Event._pageInit()}tinyMCE.init(e);d=true}}});Ext.ComponentMgr.registerType("tinymce",Ext.ux.TinyMCE);var b=Ext.extend(function(e){b.superclass.constructor.call(this,e)},tinymce.WindowManager,{alert:function(f,e,g){Ext.MessageBox.alert("",f,function(){if(!Ext.isEmpty(e)){e.call(this)}},g)},confirm:function(f,e,g){Ext.MessageBox.confirm("",f,function(h){if(!Ext.isEmpty(e)){e.call(this,h=="yes")}},g)},open:function(e,g){e=e||{};g=g||{};if(!e.type){this.bookmark=this.editor.selection.getBookmark("simple")}e.width=parseInt(e.width||320);e.height=parseInt(e.height||240)+(tinymce.isIE?8:0);e.min_width=parseInt(e.min_width||150);e.min_height=parseInt(e.min_height||100);e.max_width=parseInt(e.max_width||2000);e.max_height=parseInt(e.max_height||2000);e.movable=true;e.resizable=true;g.mce_width=e.width;g.mce_height=e.height;g.mce_inline=true;this.features=e;this.params=g;var f=new Ext.Window({title:e.name,width:e.width,height:e.height,minWidth:e.min_width,minHeight:e.min_height,resizable:true,maximizable:e.maximizable,minimizable:e.minimizable,modal:true,stateful:false,constrain:true,manager:c,layout:"fit",items:[new Ext.BoxComponent({autoEl:{tag:"iframe",src:e.url||e.file},style:"border-width: 0px;"})]});g.mce_window_id=f.getId();f.show(null,function(){if(e.left&&e.top){f.setPagePosition(e.left,e.top)}var h=f.getPosition();e.left=h[0];e.top=h[1];this.onOpen.dispatch(this,e,g)},this);return f},close:function(f){if(!f.tinyMCEPopup||!f.tinyMCEPopup.id){b.superclass.close.call(this,f);return}var e=Ext.getCmp(f.tinyMCEPopup.id);if(e){this.onClose.dispatch(this);e.close()}},setTitle:function(g,f){if(!g.tinyMCEPopup||!g.tinyMCEPopup.id){b.superclass.setTitle.call(this,g,f);return}var e=Ext.getCmp(g.tinyMCEPopup.id);if(e){e.setTitle(f)}},resizeBy:function(f,h,i){var e=Ext.getCmp(i);if(e){var g=e.getSize();e.setSize(g.width+f,g.height+h)}},focus:function(f){var e=Ext.getCmp(f);if(e){e.setActive(true)}}});var a=Ext.extend(function(g,e,f){this.control=g;a.superclass.constructor.call(this,e,f)},tinymce.ControlManager,{control:null,createDropMenu:function(h,f){var e=a.superclass.createDropMenu.call(this,h,f);var g=e.showMenu;e.showMenu=function(i,k,j){g.call(this,i,k,j);Ext.fly("menu_"+this.id).setStyle("z-index",200001)};return e},createColorSplitButton:function(h,f){var e=a.superclass.createColorSplitButton.call(this,h,f);var g=e.showMenu;e.showMenu=function(i,k,j){g.call(this,i,k,j);Ext.fly(this.id+"_menu").setStyle("z-index",200001)};return e}})})();